<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <!-- saved from url=(0014) about:internet  -->
  <title>atm</title>
</head>
<style type="text/css">
  body {
    margin: 0;
    padding: 0;
  }

  .fp {
    /*display: inline-block;*/
    display: none;
  }
</style>
<body>
<div class="fp">
  设备响应<br>指纹
</div>
<div class="fp">
  设备响应<br>身份证
</div>
<div class="fp">
  设备响应<br>现金
</div>
<div class="fp">
  设备响应<br>凭条
</div>
<div id="app"></div>
<!-- built files will be auto injected -->
</body>

<script>
  var csharp;
  function VD() {
    let _this = this;
    this.req = function (name, ...params) {
      let str = '<root><devicename>';
      str += name;
      str = str + '</devicename>';
      if (params.length == 0) {
      }
      str = str + '</root>';
      csharp.toVsBus(str);
      console.log('下发数据');
      console.log(str);
    };
    this.exec = function (suc, err) {
      _this.suc = suc;
      _this.err = err;
    };

    /*
     * 响应数据结构
     * errCode 错误均为负，0 正常，正数其他状态
     * 错误时 example={errCode:-1,data:{msg:'error-message'}}
     * 正确时 example={errCode:0,data:{idcode:131313,gender:'male'}}（身份证）
     * 正确时 example={errCode:0,data:{pic:'FIOWU3273RYHUIFDJ384272HJIWE39'}}（指纹base64）
     */
    this.res = function (resStr) {
      let res = {errCode: 0};
      eval('res=' + resStr);
      if (res.errCode == 0) {
        if (typeof _this.suc === "function") {
          _this.suc(res);
        }
      }
      if (res.errCode > 0) {
        if (typeof _this.suc === "function") {
          _this.suc(res);
        }
      }
      if (res.errCode < 0) {
        if (typeof _this.err === "function") {
          _this.err(res.msg);
        }
      }
//      _this.suc = null;
//      _this.err = null;
    }
  }
  const vueDevice = new VD();

  //    -------------------------------
  //    硬件事件仿真
  var el = document.getElementsByClassName('fp');
  function a() {
    vueDevice.res("{fingerprints:{pic:'FIOWU3273RYHUIFDJ384272HJIWE3'},errCode:0,msg:'error fp'}");
  }
  function b() {
    vueDevice.res("{idcard:{idcode:131313,gender:'male'},errCode:1,msg:'kk'}");
  }
  function c() {
    vueDevice.res("{cash:{amount:10000},errCode:0}");
  }
  function d() {
    vueDevice.res("{receipt:{content:'recepter'},errCode:0}");
  }
  el[0].addEventListener('click', a);
  el[1].addEventListener('click', b);
  el[2].addEventListener('click', c);
  el[3].addEventListener('click', d);

</script>
</html>
