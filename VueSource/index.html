<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <!-- saved from url=(0014) about:internet  -->
  <title>atm</title>
</head>
<style type="text/css">
  body {
    margin: 0;
    padding: 0;
  }

  .fp {
    /*display: inline-block;*/
    display: none;
  }
</style>
<body>
<div class="fp">
  设备响应<br>指纹
</div>
<div class="fp">
  设备响应<br>身份证
</div>
<div class="fp">
  设备响应<br>现金
</div>
<div class="fp">
  设备响应<br>凭条
</div>
<script>
  var csharp;
  function VD() {
    let _this = this;
    this.req = function (name, ...params) {
      let str = '<?xml version="1.0" encoding="utf-8"?><root><device>';
      str += name;
      str = str + '</device>';
      if (params.length != 0) {
        str += '<params>';
        for (let i = 0; i < params.length; i += 2) {
          str += '<' + params[i] + '>';
          str += params[i + 1];
          str += '</' + params[i] + '>';
        }
        str += '</params>';
      }
      str = str + '</root>';
      csharp.toVsBus(str);
      console.log('[ATM]:Send Vs Data: ' + str.substring(38));
    };
    this.exec = function (suc, err) {
      _this.suc = suc;
      _this.err = err;
    };

    /*
     * 响应数据结构
     * errCode 错误均为负，0 正常，正数其他状态
     * 错误时 example={idcard:{idCode:131313,gender:'male'},errCode:-1,msg:'kk'}
     */

    this.res = function (resStr) {
      let res = {errCode: 0};
      eval('res=' + resStr);
      if (res.errCode == 0) {
        if (typeof _this.suc === "function") {
          _this.suc(res);
        }
      }
      if (res.errCode > 0) {
        if (typeof _this.suc === "function") {
          _this.suc(res);
        }
      }
      if (res.errCode < 0) {
        if (typeof _this.err === "function") {
          _this.err(res.msg);
        }
      }
    }
  }
  const vueDevice = new VD();

  //    -------------------------------
  //    硬件事件仿真
  var el = document.getElementsByClassName('fp');
  function a() {
    vueDevice.res("{fingerPrints:{pic:'FIOWU3273RYHUIFDJ384272HJIWE3'},errCode:0,msg:'error fp'}");
  }
  function b() {
    vueDevice.res("{idCard:{idCode:131313,gender:'male'},errCode:1,msg:'kk'}");
  }
  function c() {
    vueDevice.res("{cash:{amount:10000},errCode:0}");
  }
  function d() {
    vueDevice.res("{receipt:{content:'recepter'},errCode:0}");
  }
  el[0].addEventListener('click', a);
  el[1].addEventListener('click', b);
  el[2].addEventListener('click', c);
  el[3].addEventListener('click', d);

</script>

<div id="app"></div>
<!-- built files will be auto injected -->

</body>
</html>
